<!DOCTYPE html>
<html lang="zh-cn" itemscope itemtype="http://schema.org/WebPage">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Redhat ceph-ansible 快速部署流程 - 梅炜 个人博客</title>
  

<meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta name="MobileOptimized" content="width"/>
<meta name="HandheldFriendly" content="true"/>


<meta name="applicable-device" content="pc,mobile">

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">

<meta name="mobile-web-app-capable" content="yes">

<meta name="author" content="willmei" />
  <meta name="description" content="这份笔记主要用于介绍如何使用红帽 ceph-ansible 快速部署 ceph集群的操作参考, 这里的系统版本是 红帽 7.3(推荐的是7.5但是7.3也是可以的), ceph" />

  <meta name="keywords" content="Hugo, theme, jane" />






<meta name="generator" content="Hugo 0.64.1" />


<link rel="canonical" href="https://www.iterdaily.com/post/rhel-ceph-ansible-deployment/" />





<link rel="icon" href="/favicon.ico" />











<link rel="stylesheet" href="/sass/jane.min.af20b78e95c84de86b00a0242a4a77bd2601700e1b250edf27537d957ac0041d.css" integrity="sha256-ryC3jpXITehrAKAkKkp3vSYBcA4bJQ7fJ1N9lXrABB0=" media="screen" crossorigin="anonymous">




<link rel="stylesheet" href="/css/custom_code.css">


<meta property="og:title" content="Redhat ceph-ansible 快速部署流程" />
<meta property="og:description" content="这份笔记主要用于介绍如何使用红帽 ceph-ansible 快速部署 ceph集群的操作参考, 这里的系统版本是 红帽 7.3(推荐的是7.5但是7.3也是可以的), ceph" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.iterdaily.com/post/rhel-ceph-ansible-deployment/" />
<meta property="article:published_time" content="2019-11-28T00:00:00+00:00" />
<meta property="article:modified_time" content="2019-11-28T00:00:00+00:00" />
<meta itemprop="name" content="Redhat ceph-ansible 快速部署流程">
<meta itemprop="description" content="这份笔记主要用于介绍如何使用红帽 ceph-ansible 快速部署 ceph集群的操作参考, 这里的系统版本是 红帽 7.3(推荐的是7.5但是7.3也是可以的), ceph">
<meta itemprop="datePublished" content="2019-11-28T00:00:00&#43;00:00" />
<meta itemprop="dateModified" content="2019-11-28T00:00:00&#43;00:00" />
<meta itemprop="wordCount" content="3566">



<meta itemprop="keywords" content="ceph,ansible," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Redhat ceph-ansible 快速部署流程"/>
<meta name="twitter:description" content="这份笔记主要用于介绍如何使用红帽 ceph-ansible 快速部署 ceph集群的操作参考, 这里的系统版本是 红帽 7.3(推荐的是7.5但是7.3也是可以的), ceph"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->




</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">ITer Daily</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://www.iterdaily.com/">主页</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://www.iterdaily.com/post/">全部文章/存档</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://www.iterdaily.com/tags/">关键词/标签</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://www.iterdaily.com/categories/"> 领域/分类</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://www.iterdaily.com/about/">作者</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          <div class="mobile-menu-parent">
            <span class="mobile-submenu-open"></span>
            <a href="https://www.iterdaily.com/about/">
              友站
            </a>
          </div>
          <ul class="mobile-submenu-list">
            
              <li>
                <a href="https://docs.iterdaily.com">在线文档</a>
              </li>
            
              <li>
                <a href="https://kanban.iterdaily.com">Wekan 看板</a>
              </li>
            
              <li>
                <a href="https://git.iterdaily.com">GitLab 仓库</a>
              </li>
            
              <li>
                <a href="https://jenkins.iterdaily.com">Jenkins 服务器</a>
              </li>
            
          </ul>
        
      </li>
    

    
  </ul>
</nav>


  
    






  <link rel="stylesheet" href="/lib/photoswipe/photoswipe.min.css" />
  <link rel="stylesheet" href="/lib/photoswipe/default-skin/default-skin.min.css" />




<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

<div class="pswp__bg"></div>

<div class="pswp__scroll-wrap">
    
    <div class="pswp__container">
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
    </div>
    
    <div class="pswp__ui pswp__ui--hidden">
    <div class="pswp__top-bar">
      
      <div class="pswp__counter"></div>
      <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
      <button class="pswp__button pswp__button--share" title="Share"></button>
      <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
      <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
      
      
      <div class="pswp__preloader">
        <div class="pswp__preloader__icn">
          <div class="pswp__preloader__cut">
            <div class="pswp__preloader__donut"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
      <div class="pswp__share-tooltip"></div>
    </div>
    <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
    </button>
    <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
    </button>
    <div class="pswp__caption">
      <div class="pswp__caption__center"></div>
    </div>
    </div>
    </div>
</div>

  

  

  

  <header id="header" class="header container">
    <div class="logo-wrapper">
  <a href="/" class="logo">
    
      ITer Daily
    
  </a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://www.iterdaily.com/">主页</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://www.iterdaily.com/post/">全部文章/存档</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://www.iterdaily.com/tags/">关键词/标签</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://www.iterdaily.com/categories/"> 领域/分类</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://www.iterdaily.com/about/">作者</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          <a class="menu-item-link menu-parent" href="https://www.iterdaily.com/about/">友站</a>
          <ul class="submenu">
            
              <li>
                <a href="https://docs.iterdaily.com">在线文档</a>
              </li>
            
              <li>
                <a href="https://kanban.iterdaily.com">Wekan 看板</a>
              </li>
            
              <li>
                <a href="https://git.iterdaily.com">GitLab 仓库</a>
              </li>
            
              <li>
                <a href="https://jenkins.iterdaily.com">Jenkins 服务器</a>
              </li>
            
          </ul>

        

      </li>
    

    
    

    
  </ul>
</nav>

  </header>

  <div id="mobile-panel">
    <main id="main" class="main bg-llight">
      <div class="content-wrapper">
        <div id="content" class="content container">
          <article class="post bg-white">
    
    <header class="post-header">
      <h1 class="post-title">Redhat ceph-ansible 快速部署流程</h1>
      
      <div class="post-meta">
        <time datetime="2019-11-28" class="post-time">
          2019-11-28
        </time>
        <div class="post-category">
            <a href="https://www.iterdaily.com/categories/linux/"> linux </a>
            <a href="https://www.iterdaily.com/categories/ceph/"> ceph </a>
            
          </div>
        

        
        
          <span id="busuanzi_container_page_pv">
            | 阅读 <span id="busuanzi_value_page_pv"></span>
          </span>
        

        
        
      </div>
    </header>

    
    
<div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">文章目录</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#部署准备">部署准备</a></li>
    <li><a href="#节点环境信息">节点环境信息：</a></li>
    <li><a href="#环境配置与检查">环境配置与检查</a>
      <ul>
        <li></li>
      </ul>
    </li>
    <li><a href="#执行部署">执行部署</a></li>
    <li><a href="#检查部署">检查部署</a></li>
  </ul>
</nav>
  </div>
</div>

    
    <div class="post-content">
      <p>这份笔记主要用于介绍如何使用红帽 ceph-ansible 快速部署 ceph集群的操作参考, 这里的系统版本是  红帽 7.3(推荐的是7.5但是7.3也是可以的), ceph版本是 红帽ceph 3.1, 我们的总体流程是：</p>
<ol>
<li>部署环境准备</li>
<li>集群节点准备</li>
<li>部署节点配置与检查
<ol>
<li>配置 ceph-ansible <code>all.yml</code></li>
<li>配置 ceph-ansible <code>osd.yml</code></li>
<li>配置 ansible 主机清单</li>
</ol>
</li>
<li>执行部署</li>
<li>检查部署</li>
</ol>
<h2 id="部署准备">部署准备</h2>
<p>在你部署前确认一下内容已经完备：</p>
<ol>
<li>选定的存储引擎
filestore / bluestore
默认：bluestore</li>
<li>主机网络
集群网络 cluster_network
服务网络 public_network</li>
<li>其他可能需要的网络 如,  管理网,  ipmi等</li>
<li>数据盘与日志盘配置
<ol>
<li>使用数据盘自身分区做 journal,  无需特殊配置</li>
<li>一SSD对多数据盘,  比例范围 1: 6~10（仅作建议）</li>
<li>全闪存磁盘,  单盘OSD数建议数值:4,  请参考SSD规格与接口规格调整</li>
</ol>
</li>
<li>权限与免密
可以配置单独的 ansible 用户,  但请配置管理员权限和有效的登录方式,
完成 user, password, sudoer, ssh等</li>
<li>所使用 ceph 版本</li>
<li>服务器 OS 版本</li>
<li>时间同步服务器 (建议)</li>
<li>机架信息与 crushmap 故障域方案 (建议)</li>
</ol>
<p>这里有 <a href="https://access.redhat.com/documentation/en-us/red_hat_ceph_storage/3/html/installation_guide_for_red_hat_enterprise_linux/deploying-red-hat-ceph-storage">官方部署文档</a>, 部署前可以仔细阅读以供参考.</p>
<h2 id="节点环境信息">节点环境信息：</h2>
<p>示例 ceph 集群节点</p>
<table>
<thead>
<tr>
<th>主机名</th>
<th>管理IP</th>
<th>存储网络IP</th>
<th>角色</th>
</tr>
</thead>
<tbody>
<tr>
<td>kvm-64</td>
<td>192.168.17.64/22</td>
<td>172.16.0.64/22</td>
<td>mon, mgr, mds, radosgw, osd</td>
</tr>
<tr>
<td>kvm-65</td>
<td>192.168.17.65/22</td>
<td>172.16.0.65/22</td>
<td>mon, mgr, mds, radosgw, osd</td>
</tr>
<tr>
<td>kvm-66</td>
<td>192.168.17.66/22</td>
<td>172.16.0.66/22</td>
<td>mon, mgr, mds, radosgw, osd</td>
</tr>
</tbody>
</table>
<h2 id="环境配置与检查">环境配置与检查</h2>
<h4 id="所有节点-环境准备">所有节点-环境准备</h4>
<ol>
<li>网络检测, 请确保节点之间的
<ol>
<li>网络互通,  存储与服务网链路正常</li>
<li>ssh登录状态正常</li>
</ol>
</li>
<li>节点主机名配置 (请确认主机名配置正确,  部署后主机名请勿轻易改动)</li>
<li>配置软件源
rhceph镜像本地软件源(建议)或其他软件源,  请确认ceph版本与依赖关系正常</li>
<li>系统安全更新</li>
<li>关闭 selinux 子系统</li>
<li>防火墙状态检查</li>
<li>检查磁盘健康状态, 清理磁盘.</li>
</ol>
<p>配置一下 <code>/etc/hosts</code> 主机名解析, 如果不做解析也可以直接使用IP地址, 但是建议使用主机名解析, 相对而言利于维护.</p>
<pre><code>127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4
::1         localhost localhost.localdomain localhost6 localhost6.localdomain6

192.168.17.64 kvm-64
192.168.17.65 kvm-65
192.168.17.66 kvm-66

172.16.0.64 kvm-64
172.16.0.65 kvm-65
172.16.0.66 kvm-66
</code></pre><p>YUM 软件源配置参考</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ini" data-lang="ini"><span style="color:#66d9ef">[rhel-7-server-rpms]</span>
<span style="color:#a6e22e">name</span><span style="color:#f92672">=</span><span style="color:#e6db74">rhel-7-server-rpms</span>
<span style="color:#a6e22e">baseurl</span><span style="color:#f92672">=</span><span style="color:#e6db74">http://192.168.17.38/rhel-7-server-rpms</span>
<span style="color:#a6e22e">enabled</span><span style="color:#f92672">=</span><span style="color:#e6db74">1</span>
<span style="color:#a6e22e">gpgcheck</span><span style="color:#f92672">=</span><span style="color:#e6db74">0</span>

<span style="color:#66d9ef">[rhel-7-server-extras-rpms]</span>
<span style="color:#a6e22e">name</span><span style="color:#f92672">=</span><span style="color:#e6db74">rhel-7-server-extras-rpms</span>
<span style="color:#a6e22e">baseurl</span><span style="color:#f92672">=</span><span style="color:#e6db74">http://192.168.17.38/rhel-7-server-extras-rpms</span>
<span style="color:#a6e22e">enabled</span><span style="color:#f92672">=</span><span style="color:#e6db74">1</span>
<span style="color:#a6e22e">gpgcheck</span><span style="color:#f92672">=</span><span style="color:#e6db74">0</span>

<span style="color:#66d9ef">[rhceph-3-mon]</span>
<span style="color:#a6e22e">name</span><span style="color:#f92672">=</span><span style="color:#e6db74">rhceph-3-mon</span>
<span style="color:#a6e22e">baseurl</span><span style="color:#f92672">=</span><span style="color:#e6db74">http://192.168.17.38/rhceph-3.1-rhel-7-x86_64.iso/MON</span>
<span style="color:#a6e22e">enabled</span><span style="color:#f92672">=</span><span style="color:#e6db74">1</span>
<span style="color:#a6e22e">gpgcheck</span><span style="color:#f92672">=</span><span style="color:#e6db74">0</span>

<span style="color:#66d9ef">[rhceph-3-osd]</span>
<span style="color:#a6e22e">name</span><span style="color:#f92672">=</span><span style="color:#e6db74">rhceph-3-osd</span>
<span style="color:#a6e22e">baseurl</span><span style="color:#f92672">=</span><span style="color:#e6db74">http://192.168.17.38/rhceph-3.1-rhel-7-x86_64.iso/OSD</span>
<span style="color:#a6e22e">enabled</span><span style="color:#f92672">=</span><span style="color:#e6db74">1</span>
<span style="color:#a6e22e">gpgcheck</span><span style="color:#f92672">=</span><span style="color:#e6db74">0</span>

<span style="color:#66d9ef">[rhceph-3-tools]</span>
<span style="color:#a6e22e">name</span><span style="color:#f92672">=</span><span style="color:#e6db74">rhceph-3-tools</span>
<span style="color:#a6e22e">baseurl</span><span style="color:#f92672">=</span><span style="color:#e6db74">http://192.168.17.38/rhceph-3.1-rhel-7-x86_64.iso/Tools</span>
<span style="color:#a6e22e">enabled</span><span style="color:#f92672">=</span><span style="color:#e6db74">1</span>
<span style="color:#a6e22e">gpgcheck</span><span style="color:#f92672">=</span><span style="color:#e6db74">0</span>

<span style="color:#66d9ef">[rhel-7-server-iso-base]</span>
<span style="color:#a6e22e">name</span><span style="color:#f92672">=</span><span style="color:#e6db74">rhel-7-server-iso-base</span>
<span style="color:#a6e22e">baseurl</span><span style="color:#f92672">=</span><span style="color:#e6db74">http://192.168.17.38/rhel-server-7.5-x86_64-dvd.iso/</span>
<span style="color:#a6e22e">enabled</span><span style="color:#f92672">=</span><span style="color:#e6db74">0</span>
<span style="color:#a6e22e">gpgcheck</span><span style="color:#f92672">=</span><span style="color:#e6db74">0</span>
</code></pre></div><p>Firewalld 的防火墙配置参考, 测试环境选择关闭防火墙也可以.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#75715e"># MON节点</span>
firewall-cmd --zone<span style="color:#f92672">=</span>public --add-port<span style="color:#f92672">=</span>6789/tcp --permanent

<span style="color:#75715e"># OSD节点</span>
firewall-cmd --zone<span style="color:#f92672">=</span>public --add-port<span style="color:#f92672">=</span>6800-7300/tcp --permanent

<span style="color:#75715e"># MGR节点</span>
firewall-cmd --zone<span style="color:#f92672">=</span>public --add-port<span style="color:#f92672">=</span>6800-7300/tcp --permanent

<span style="color:#75715e"># MDS节点</span>
firewall-cmd --zone<span style="color:#f92672">=</span>public --add-port<span style="color:#f92672">=</span>6800/tcp --permanent

<span style="color:#75715e"># RGW节点</span>
firewall-cmd --zone<span style="color:#f92672">=</span>public --add-port<span style="color:#f92672">=</span>8080/tcp --permanent
firewall-cmd --zone<span style="color:#f92672">=</span>public --add-port<span style="color:#f92672">=</span>443/tcp --permanent

<span style="color:#75715e"># 重新加载防火墙规则</span>
firewall-cmd --reload
</code></pre></div><p>数据磁盘清理的参考, 建议对使用的磁盘进行清理和检查, 这里使用脚本清理了所有的非系统盘.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#75715e">#!/bin/bash
</span><span style="color:#75715e"></span>
root_blk<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>lsblk -pr |grep boot$ |awk <span style="color:#e6db74">&#39;{print$1}&#39;</span> |sed <span style="color:#e6db74">&#34;s/[0-9]//g&#34;</span><span style="color:#66d9ef">)</span>

blk_list<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>lsblk |grep -v $root_blk |grep ^s |awk <span style="color:#e6db74">&#39;{print$1}&#39;</span><span style="color:#66d9ef">)</span>

yum -y install gdisk

<span style="color:#66d9ef">for</span> i in $blk_list ;<span style="color:#66d9ef">do</span>

    blk<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">/dev/</span>$i<span style="color:#e6db74">&#34;</span>
    <span style="color:#f92672">[</span><span style="color:#f92672">[</span> $blk <span style="color:#f92672">=</span> $root_blk <span style="color:#f92672">]</span><span style="color:#f92672">]</span> <span style="color:#f92672">&amp;&amp;</span> echo <span style="color:#e6db74">&#34;</span>$blk<span style="color:#e6db74"> skiped</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#66d9ef">continue</span>

    echo  sgdisk --zap-all $blk
    sgdisk --zap-all $blk

<span style="color:#66d9ef">done</span>
</code></pre></div><p>其他诸如 ntp ssh 等等, 大家根据自己环境要求的差异配置上就好了.</p>
<h4 id="部署节点-配置部署选项">部署节点-配置部署选项</h4>
<p>首先需要安装部署工具, 这里的 ceph-ansible 安装包以及 iso文件等 是从内网源直接下载获取的, 但是要保持部署工具和ceph的版本相一致.</p>
<p>注意, ceph-ansible 与 ceph 的版本通常是相互对应的, ceph3.1 需要 ceph-ansible3.1进行安装, 因为当依赖的ansible版本为2.5以下时才能保证 ceph-ansible3.1 中 playbook 语法正常解析.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#75715e">#安装ceph-ansible软件包</span>
yum -y install ceph-ansible

<span style="color:#75715e">#创建集群密钥存放目录</span> 
mkdir ~/ceph-ansible-keys

<span style="color:#75715e">#create symbolic link</span>
ln -s /usr/share/ceph-ansible/group_vars /etc/ansible/group_vars

<span style="color:#75715e">#navigate to ceph-ansible dir</span>
cd /usr/share/ceph-ansible

<span style="color:#75715e">#将部署 ISO 存放到部署机 (这里从内网下载了红帽的ceph安装镜像文件)</span>
mkdir /opt/ceph/
wget http://192.168.17.98/iso/rhceph-3.1-rhel-7-x86_64.iso -O /opt/ceph/rhceph-3.1-rhel-7-x86_64.iso

<span style="color:#75715e">#从模板创建配置文件</span>
cp group_vars/all.yml.sample group_vars/all.yml
cp group_vars/osds.yml.sample group_vars/osds.yml
cp site.yml.sample site.yml
</code></pre></div><p>接下来要定义我们部署的 ceph 环境配置, 需要配置的文件主要有:</p>
<ol>
<li><code>group_vars/all.yml</code>    全局配置</li>
<li><code>group_vars/osd.yml</code>    osd 节点配置</li>
<li><code>/etc/ansible/hosts</code>    ansible 资产清单</li>
</ol>
<p>至于 <code>site.yml</code> 是控制部署流程 ansible 剧本, 通常情况下是不需要调整的, 使用默认配置即可.</p>
<p>配置文件中的各种可选参数和写法格式等内容较多,  详细参数查阅参见 <a href="https://access.redhat.com/documentation/en-us/red_hat_ceph_storage/3/html/installation_guide_for_red_hat_enterprise_linux/deploying-red-hat-ceph-storage#prerequisites_6">官方配置说明文档</a> , 这里我们给出一个快速部署的配置示例.</p>
<p>配置 <code>group_vars/all.yml</code></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">---
<span style="color:#66d9ef">dummy</span>:
<span style="color:#66d9ef">fetch_directory</span>: ~/ceph-ansible-keys
<span style="color:#66d9ef">ceph_repository_type</span>: iso
<span style="color:#66d9ef">ceph_origin</span>: repository
<span style="color:#66d9ef">ceph_repository</span>: rhcs
<span style="color:#66d9ef">ceph_rhcs_version</span>: <span style="color:#ae81ff">3</span>
<span style="color:#66d9ef">ceph_rhcs_iso_path</span>: /opt/ceph/rhceph<span style="color:#ae81ff">-3.1</span>-rhel<span style="color:#ae81ff">-7</span>-x86_64.iso
<span style="color:#66d9ef">monitor_address_block</span>: <span style="color:#ae81ff">192.168</span><span style="color:#ae81ff">.17</span><span style="color:#ae81ff">.0</span>/<span style="color:#ae81ff">22</span>
<span style="color:#66d9ef">public_network</span>: <span style="color:#ae81ff">192.168</span><span style="color:#ae81ff">.17</span><span style="color:#ae81ff">.0</span>/<span style="color:#ae81ff">22</span>
<span style="color:#66d9ef">cluster_network</span>: <span style="color:#ae81ff">172.16</span><span style="color:#ae81ff">.0</span><span style="color:#ae81ff">.0</span>/<span style="color:#ae81ff">22</span>
<span style="color:#66d9ef">radosgw_address_block</span>: <span style="color:#ae81ff">192.168</span><span style="color:#ae81ff">.17</span><span style="color:#ae81ff">.0</span>/<span style="color:#ae81ff">22</span>
</code></pre></div><p>这里的网络信息可以根据自己的网络环境进行调整, 也可以都使用一个网络, 如</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">---
<span style="color:#66d9ef">dummy</span>:
<span style="color:#66d9ef">fetch_directory</span>: ~/ceph-ansible-keys
<span style="color:#66d9ef">ceph_repository_type</span>: iso
<span style="color:#66d9ef">ceph_origin</span>: repository
<span style="color:#66d9ef">ceph_repository</span>: rhcs
<span style="color:#66d9ef">ceph_rhcs_version</span>: <span style="color:#ae81ff">3</span>
<span style="color:#66d9ef">ceph_rhcs_iso_path</span>: /opt/ceph/rhceph<span style="color:#ae81ff">-3.1</span>-rhel<span style="color:#ae81ff">-7</span>-x86_64.iso
<span style="color:#66d9ef">monitor_address_block</span>: <span style="color:#ae81ff">192.168</span><span style="color:#ae81ff">.3</span><span style="color:#ae81ff">.0</span>/<span style="color:#ae81ff">24</span>
<span style="color:#66d9ef">public_network</span>: <span style="color:#ae81ff">192.168</span><span style="color:#ae81ff">.3</span><span style="color:#ae81ff">.0</span>/<span style="color:#ae81ff">24</span>
<span style="color:#66d9ef">cluster_network</span>: <span style="color:#ae81ff">192.168</span><span style="color:#ae81ff">.3</span><span style="color:#ae81ff">.0</span>/<span style="color:#ae81ff">24</span>
<span style="color:#66d9ef">radosgw_address_block</span>: <span style="color:#ae81ff">192.168</span><span style="color:#ae81ff">.3</span><span style="color:#ae81ff">.0</span>/<span style="color:#ae81ff">24</span>
</code></pre></div><p>除了可以使用在 <code>all.yml</code> 指定子网的方式来配置网络,  也可以在 ansible 主机清单中指定具体的网卡对网络进行配置.</p>
<p>配置 <code>group_vars/osd.yml</code></p>
<p>OSD 的配置是与机器的磁盘配置对应的, 这里有4 块固态硬盘作日志盘, 并且机器磁盘规格以及识别的名称都是一样的</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#f92672">[</span>root@kvm-64 ~<span style="color:#f92672">]</span><span style="color:#75715e"># lsblk</span>
NAME          MAJ:MIN RM   SIZE RO TYPE MOUNTPOINT
sda             8:0    <span style="color:#ae81ff">0</span>   1.8T  <span style="color:#ae81ff">0</span> disk
├─sda1          8:1    <span style="color:#ae81ff">0</span>   200M  <span style="color:#ae81ff">0</span> part /boot/efi
├─sda2          8:2    <span style="color:#ae81ff">0</span>     1G  <span style="color:#ae81ff">0</span> part /boot
└─sda3          8:3    <span style="color:#ae81ff">0</span>   1.8T  <span style="color:#ae81ff">0</span> part
  ├─rhel-root 253:0    <span style="color:#ae81ff">0</span>    50G  <span style="color:#ae81ff">0</span> lvm  /
  ├─rhel-swap 253:1    <span style="color:#ae81ff">0</span>     4G  <span style="color:#ae81ff">0</span> lvm  <span style="color:#f92672">[</span>SWAP<span style="color:#f92672">]</span>
  └─rhel-home 253:2    <span style="color:#ae81ff">0</span>   1.8T  <span style="color:#ae81ff">0</span> lvm  /home
sdb             8:16   <span style="color:#ae81ff">0</span>   1.8T  <span style="color:#ae81ff">0</span> disk
sdc             8:32   <span style="color:#ae81ff">0</span> 446.1G  <span style="color:#ae81ff">0</span> disk <span style="color:#75715e"># ssd</span>
sdd             8:48   <span style="color:#ae81ff">0</span> 446.1G  <span style="color:#ae81ff">0</span> disk <span style="color:#75715e"># ssd</span>
sde             8:64   <span style="color:#ae81ff">0</span> 446.1G  <span style="color:#ae81ff">0</span> disk <span style="color:#75715e"># ssd</span>
sdf             8:80   <span style="color:#ae81ff">0</span> 446.1G  <span style="color:#ae81ff">0</span> disk <span style="color:#75715e"># ssd</span>
sdg             8:96   <span style="color:#ae81ff">0</span>   1.8T  <span style="color:#ae81ff">0</span> disk
sdh             8:112  <span style="color:#ae81ff">0</span>   1.8T  <span style="color:#ae81ff">0</span> disk
sdi             8:128  <span style="color:#ae81ff">0</span>   1.8T  <span style="color:#ae81ff">0</span> disk
sdj             8:144  <span style="color:#ae81ff">0</span>   1.8T  <span style="color:#ae81ff">0</span> disk
sdk             8:160  <span style="color:#ae81ff">0</span>   1.8T  <span style="color:#ae81ff">0</span> disk
sdl             8:176  <span style="color:#ae81ff">0</span>   1.8T  <span style="color:#ae81ff">0</span> disk
sdm             8:192  <span style="color:#ae81ff">0</span>   1.8T  <span style="color:#ae81ff">0</span> disk
sdn             8:208  <span style="color:#ae81ff">0</span>   1.8T  <span style="color:#ae81ff">0</span> disk
sdo             8:224  <span style="color:#ae81ff">0</span>   1.8T  <span style="color:#ae81ff">0</span> disk
sdp             8:240  <span style="color:#ae81ff">0</span>   1.8T  <span style="color:#ae81ff">0</span> disk
sdq            65:0    <span style="color:#ae81ff">0</span>   1.8T  <span style="color:#ae81ff">0</span> disk
sdr            65:16   <span style="color:#ae81ff">0</span>   1.8T  <span style="color:#ae81ff">0</span> disk
sds            65:32   <span style="color:#ae81ff">0</span>   1.8T  <span style="color:#ae81ff">0</span> disk
sdt            65:48   <span style="color:#ae81ff">0</span>   1.8T  <span style="color:#ae81ff">0</span> disk
sdu            65:64   <span style="color:#ae81ff">0</span>   1.8T  <span style="color:#ae81ff">0</span> disk
sdv            65:80   <span style="color:#ae81ff">0</span>   1.8T  <span style="color:#ae81ff">0</span> disk
sdw            65:96   <span style="color:#ae81ff">0</span>   1.8T  <span style="color:#ae81ff">0</span> disk
sdx            65:112  <span style="color:#ae81ff">0</span>   1.8T  <span style="color:#ae81ff">0</span> disk
</code></pre></div><p>因为机器的磁盘配置统一, 这里就把日志盘和数据盘的配置都统一写在 <code>osd.yml</code> 就可以了</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">---
<span style="color:#66d9ef">dummy</span>:
<span style="color:#66d9ef">osd_scenario</span>: non-collocated
<span style="color:#66d9ef">devices</span>:
 - /dev/sdb
 - /dev/sdg
 - /dev/sdh
 - /dev/sdi
 - /dev/sdj
 - /dev/sdk
 - /dev/sdl
 - /dev/sdm
 - /dev/sdn
 - /dev/sdo
 - /dev/sdp
 - /dev/sdq
 - /dev/sdr
 - /dev/sds
 - /dev/sdt
 - /dev/sdu
 - /dev/sdv
 - /dev/sdw
 - /dev/sdx
<span style="color:#66d9ef">dedicated_devices</span>:
 - /dev/sdc
 - /dev/sdd
 - /dev/sde
 - /dev/sdf

<span style="color:#75715e"># osd_scenario 可选值: </span>
<span style="color:#75715e"># lvm    使用 bluestore lvm 的场景</span>
<span style="color:#75715e"># collocated    没有ssd, osd磁盘自身的分区作journal 的场景</span>
<span style="color:#75715e"># non-collocated    有独立 ssd 盘做 journal 磁盘 的场景</span>
</code></pre></div><blockquote>
<p>关于 <code>osd_scenario</code> 三个选项的官方释义如下:</p>
<p><code>collocated</code> to use the same device for write-ahead logging and key/value data (BlueStore) or journal (FileStore) and OSD data</p>
<p><code>non-collocated</code> to use a dedicated device, such as SSD or NVMe media to store write-ahead log and key/value data (BlueStore) or journal data (FileStore)</p>
<p><code>lvm</code> to use the Logical Volume Manager to store OSD data</p>
</blockquote>
<p>编辑 <code>ansible</code> 主机清单 <code>/etc/ansible/hosts</code></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ini" data-lang="ini"><span style="color:#66d9ef">[mons]</span>
<span style="color:#a6e22e">kvm-64</span>
<span style="color:#a6e22e">kvm-65</span>
<span style="color:#a6e22e">kvm-66</span>

<span style="color:#66d9ef">[osds]</span>
<span style="color:#a6e22e">kvm-64 osd_crush_location</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;{ &#39;root&#39;: &#39;default&#39;, &#39;rack&#39;: &#39;unknown-rack&#39;, &#39;host&#39;: &#39;kvm-64&#39; }&#34;</span>
<span style="color:#a6e22e">kvm-65 osd_crush_location</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;{ &#39;root&#39;: &#39;default&#39;, &#39;rack&#39;: &#39;unknown-rack&#39;, &#39;host&#39;: &#39;kvm-65&#39; }&#34;</span>
<span style="color:#a6e22e">kvm-66 osd_crush_location</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;{ &#39;root&#39;: &#39;default&#39;, &#39;rack&#39;: &#39;unknown-rack&#39;, &#39;host&#39;: &#39;kvm-66&#39; }&#34;</span>

<span style="color:#66d9ef">[mgrs]</span>
<span style="color:#a6e22e">kvm-64</span>
<span style="color:#a6e22e">kvm-65</span>
<span style="color:#a6e22e">kvm-66</span>

<span style="color:#66d9ef">[rgws]</span>
<span style="color:#a6e22e">kvm-64</span>
<span style="color:#a6e22e">kvm-65</span>
<span style="color:#a6e22e">kvm-66</span>
</code></pre></div><h4 id="收集磁盘配置特殊环境">收集磁盘配置(特殊环境)</h4>
<p>如果碰到磁盘配置复杂的情况, 你的部署环境可能没有那么规整, 比如利用旧机器进行测试, 这时可能集群的磁盘配置并不统一, 这就需要一些额外的处理工作, 没有这种问题的同学可以跳过这个步骤. 如果磁盘配置并不统一, 那我们就不能将配置统一写在 <code>osd.yml</code> 中了, 这时可以选择把 OSD 主机的磁盘配置写在主机清单中, 像下面这样</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ini" data-lang="ini"><span style="color:#a6e22e">...</span>

<span style="color:#66d9ef">[osds]</span>
<span style="color:#a6e22e">red-hat-ceph-55 devices</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;[&#39;/dev/sdb&#39;, &#39;/dev/sdc&#39;, &#39;/dev/sdd&#39;, &#39;/dev/sde&#39;, &#39;/dev/sdf&#39;, &#39;/dev/sdg&#39;, &#39;/dev/sdh&#39;, &#39;/dev/sdi&#39;, &#39;/dev/sdj&#39;, &#39;/dev/sdk&#39;, &#39;/dev/sdl&#39;, &#39;/dev/sdm&#39;, &#39;/dev/sdn&#39;, &#39;/dev/sdo&#39;, &#39;/dev/sdp&#39;, &#39;/dev/sdq&#39;, &#39;/dev/sdr&#39;, &#39;/dev/sds&#39;, &#39;/dev/sdt&#39;, &#39;/dev/sdu&#39;]&#34;  dedicated_devices=&#34;[&#39;/dev/sdv&#39;, &#39;/dev/sdw&#39;, &#39;/dev/sdx&#39;]&#34; osd_crush_location=&#34;{ &#39;root&#39;: &#39;default&#39;, &#39;rack&#39;: &#39;DD-F04-ZU-C04&#39;, &#39;host&#39;: &#39;red-hat-ceph-55&#39; }&#34;</span>
<span style="color:#a6e22e">...</span>
</code></pre></div><p>如果仅仅是某些机器多了或者少了一两个磁盘, 而主机上磁盘顺序统一还是比较好处理的, 例如使用一个 python 列表生成式来生成磁盘名的序列然后复制编辑即可,</p>
<p><code>['/dev/sd' + chr(x) for x in range(ord('b'), ord('x')+1)]</code> ,</p>
<p>但是如果除了机器磁盘数量不一样, 连机械硬盘和固态硬盘的顺序也各自不太一样, 并且集群中主机数和磁盘数可能还都比较多, 这种情形下我们可以使用脚本收集磁盘信息然后进行汇总.</p>
<p>这里我们用一个简单的脚本就可以统计主机上不同类型的磁盘了.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#75715e">#!/bin/bash
</span><span style="color:#75715e"></span>
root_blk<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>lsblk -pr |grep boot$ |awk <span style="color:#e6db74">&#39;{print$1}&#39;</span> |sed <span style="color:#e6db74">&#34;s/[0-9]//g&#34;</span><span style="color:#66d9ef">)</span>
blk_list<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>lsblk |grep -v $root_blk |grep ^s |awk <span style="color:#e6db74">&#39;{print$1}&#39;</span><span style="color:#66d9ef">)</span>

<span style="color:#66d9ef">for</span> i in $blk_list ;<span style="color:#66d9ef">do</span>

    blk<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">/dev/</span>$i<span style="color:#e6db74">&#34;</span>
    <span style="color:#f92672">[</span><span style="color:#f92672">[</span> $blk <span style="color:#f92672">=</span> $root_blk <span style="color:#f92672">]</span><span style="color:#f92672">]</span> <span style="color:#f92672">&amp;&amp;</span> echo <span style="color:#e6db74">&#34;</span><span style="color:#e6db74"># </span>$HOSTNAME<span style="color:#e6db74"> root blk </span>$blk<span style="color:#e6db74"> skiped</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#66d9ef">continue</span>

    ROTA<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span> lsblk -pd -o NAME,ROTA $blk | awk <span style="color:#e6db74">&#39;/dev/{print$2}&#39;</span><span style="color:#66d9ef">)</span>
    <span style="color:#66d9ef">if</span> <span style="color:#f92672">[</span><span style="color:#f92672">[</span> $ROTA -eq <span style="color:#ae81ff">1</span> <span style="color:#f92672">]</span><span style="color:#f92672">]</span>;<span style="color:#66d9ef">then</span>
        <span style="color:#75715e">#echo &#34;$blk: hdd&#34;</span>
        data_blk<span style="color:#f92672">+=</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">&#39;</span>$blk<span style="color:#e6db74">&#39;, </span><span style="color:#e6db74">&#34;</span>
    <span style="color:#66d9ef">elif</span> <span style="color:#f92672">[</span><span style="color:#f92672">[</span> $ROTA -eq <span style="color:#ae81ff">0</span> <span style="color:#f92672">]</span><span style="color:#f92672">]</span>;<span style="color:#66d9ef">then</span>
        <span style="color:#75715e">#echo &#34;$blk: ssd&#34;</span>
        journal_blk<span style="color:#f92672">+=</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74"> - </span>$blk<span style="color:#e6db74">\n</span><span style="color:#e6db74">&#34;</span>
    <span style="color:#66d9ef">fi</span>
<span style="color:#66d9ef">done</span>

echo -e <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">\n</span>$HOSTNAME<span style="color:#e6db74">&#34;</span>
<span style="color:#f92672">[</span><span style="color:#f92672">[</span> -n $data_blk <span style="color:#f92672">]</span><span style="color:#f92672">]</span>    <span style="color:#f92672">&amp;&amp;</span> echo -e <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">devices=\&#34;[</span>$data_blk<span style="color:#e6db74">]\&#34;</span><span style="color:#e6db74">&#34;</span>
<span style="color:#f92672">[</span><span style="color:#f92672">[</span> -n $journal_blk <span style="color:#f92672">]</span><span style="color:#f92672">]</span> <span style="color:#f92672">&amp;&amp;</span> echo -e <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">dedicated_devices=\&#34;[</span>$journal_blk<span style="color:#e6db74">]\&#34;</span><span style="color:#e6db74">&#34;</span>
echo <span style="color:#e6db74">&#34;&#34;</span>
</code></pre></div><p>将脚本批量在集群执行就可以得到汇总信息, 如.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#75715e"># cat kvm</span>
192.168.17.64
192.168.17.65
192.168.17.66

<span style="color:#75715e"># for i in $( &lt; ~/kvm);do cat blk_info.sh |ssh $i &#39;cat - |bash&#39; ;done</span>

<span style="color:#75715e"># kvm-64 root blk /dev/sda skiped</span>
kvm-64
devices<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;[&#39;/dev/sdb&#39;, &#39;/dev/sdg&#39;, &#39;/dev/sdh&#39;, &#39;/dev/sdi&#39;, &#39;/dev/sdj&#39;, &#39;/dev/sdk&#39;, &#39;/dev/sdl&#39;, &#39;/dev/sdm&#39;, &#39;/dev/sdn&#39;, &#39;/dev/sdo&#39;, &#39;/dev/sdp&#39;, &#39;/dev/sdq&#39;, &#39;/dev/sdr&#39;, &#39;/dev/sds&#39;, &#39;/dev/sdt&#39;, &#39;/dev/sdu&#39;, &#39;/dev/sdv&#39;, &#39;/dev/sdw&#39;, &#39;/dev/sdx&#39;, ]&#34;</span>
dedicated_devices<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;[&#39;/dev/sdc&#39;, &#39;/dev/sdd&#39;, &#39;/dev/sde&#39;, &#39;/dev/sdf&#39;, ]&#34;</span>

<span style="color:#75715e"># kvm-65 root blk /dev/sda skiped</span>

kvm-65
devices<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;[&#39;/dev/sdb&#39;, &#39;/dev/sdg&#39;, &#39;/dev/sdh&#39;, &#39;/dev/sdi&#39;, &#39;/dev/sdj&#39;, &#39;/dev/sdk&#39;, &#39;/dev/sdl&#39;, &#39;/dev/sdm&#39;, &#39;/dev/sdn&#39;, &#39;/dev/sdo&#39;, &#39;/dev/sdp&#39;, &#39;/dev/sdq&#39;, &#39;/dev/sdr&#39;, &#39;/dev/sds&#39;, &#39;/dev/sdt&#39;, &#39;/dev/sdu&#39;, &#39;/dev/sdv&#39;, &#39;/dev/sdw&#39;, &#39;/dev/sdx&#39;, ]&#34;</span>
dedicated_devices<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;[&#39;/dev/sdc&#39;, &#39;/dev/sdd&#39;, &#39;/dev/sde&#39;, &#39;/dev/sdf&#39;, ]&#34;</span>

<span style="color:#75715e"># kvm-66 root blk /dev/sda skiped</span>

kvm-66
devices<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;[&#39;/dev/sdb&#39;, &#39;/dev/sdg&#39;, &#39;/dev/sdh&#39;, &#39;/dev/sdi&#39;, &#39;/dev/sdj&#39;, &#39;/dev/sdk&#39;, &#39;/dev/sdl&#39;, &#39;/dev/sdm&#39;, &#39;/dev/sdn&#39;, &#39;/dev/sdo&#39;, &#39;/dev/sdp&#39;, &#39;/dev/sdq&#39;, &#39;/dev/sdr&#39;, &#39;/dev/sds&#39;, &#39;/dev/sdt&#39;, &#39;/dev/sdu&#39;, &#39;/dev/sdv&#39;, &#39;/dev/sdw&#39;, &#39;/dev/sdx&#39;, ]&#34;</span>
dedicated_devices<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;[&#39;/dev/sdc&#39;, &#39;/dev/sdd&#39;, &#39;/dev/sde&#39;, &#39;/dev/sdf&#39;, ]&#34;</span>
</code></pre></div><p>然后将信息编辑到主机清单 <code>/etc/ansible/hosts</code>  , 结果就会像下面这样</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ini" data-lang="ini"><span style="color:#66d9ef">[mons]</span>
<span style="color:#a6e22e">kvm-64</span>
<span style="color:#a6e22e">kvm-65</span>
<span style="color:#a6e22e">kvm-66</span>

<span style="color:#66d9ef">[osds]</span>
<span style="color:#a6e22e">kvm-64 devices</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;[&#39;/dev/sdb&#39;, &#39;/dev/sdg&#39;, &#39;/dev/sdh&#39;, &#39;/dev/sdi&#39;, &#39;/dev/sdj&#39;, &#39;/dev/sdk&#39;, &#39;/dev/sdl&#39;, &#39;/dev/sdm&#39;, &#39;/dev/sdn&#39;, &#39;/dev/sdo&#39;, &#39;/dev/sdp&#39;, &#39;/dev/sdq&#39;, &#39;/dev/sdr&#39;, &#39;/dev/sds&#39;, &#39;/dev/sdt&#39;, &#39;/dev/sdu&#39;, &#39;/dev/sdv&#39;, &#39;/dev/sdw&#39;, &#39;/dev/sdx&#39;, ]&#34; dedicated_devices=&#34;[&#39;/dev/sdc&#39;, &#39;/dev/sdd&#39;, &#39;/dev/sde&#39;, &#39;/dev/sdf&#39;, ]&#34;osd_crush_location=&#34;{ &#39;root&#39;: &#39;default&#39;, &#39;rack&#39;: &#39;unknown-rack&#39;, &#39;host&#39;: &#39;kvm-64&#39; }&#34;</span>
<span style="color:#a6e22e">kvm-65 devices</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;[&#39;/dev/sdb&#39;, &#39;/dev/sdg&#39;, &#39;/dev/sdh&#39;, &#39;/dev/sdi&#39;, &#39;/dev/sdj&#39;, &#39;/dev/sdk&#39;, &#39;/dev/sdl&#39;, &#39;/dev/sdm&#39;, &#39;/dev/sdn&#39;, &#39;/dev/sdo&#39;, &#39;/dev/sdp&#39;, &#39;/dev/sdq&#39;, &#39;/dev/sdr&#39;, &#39;/dev/sds&#39;, &#39;/dev/sdt&#39;, &#39;/dev/sdu&#39;, &#39;/dev/sdv&#39;, &#39;/dev/sdw&#39;, &#39;/dev/sdx&#39;, ]&#34; dedicated_devices=&#34;[&#39;/dev/sdc&#39;, &#39;/dev/sdd&#39;, &#39;/dev/sde&#39;, &#39;/dev/sdf&#39;, ]&#34;osd_crush_location=&#34;{ &#39;root&#39;: &#39;default&#39;, &#39;rack&#39;: &#39;unknown-rack&#39;, &#39;host&#39;: &#39;kvm-65&#39; }&#34;</span>
<span style="color:#a6e22e">kvm-66 devices</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;[&#39;/dev/sdb&#39;, &#39;/dev/sdg&#39;, &#39;/dev/sdh&#39;, &#39;/dev/sdi&#39;, &#39;/dev/sdj&#39;, &#39;/dev/sdk&#39;, &#39;/dev/sdl&#39;, &#39;/dev/sdm&#39;, &#39;/dev/sdn&#39;, &#39;/dev/sdo&#39;, &#39;/dev/sdp&#39;, &#39;/dev/sdq&#39;, &#39;/dev/sdr&#39;, &#39;/dev/sds&#39;, &#39;/dev/sdt&#39;, &#39;/dev/sdu&#39;, &#39;/dev/sdv&#39;, &#39;/dev/sdw&#39;, &#39;/dev/sdx&#39;, ]&#34; dedicated_devices=&#34;[&#39;/dev/sdc&#39;, &#39;/dev/sdd&#39;, &#39;/dev/sde&#39;, &#39;/dev/sdf&#39;, ]&#34;osd_crush_location=&#34;{ &#39;root&#39;: &#39;default&#39;, &#39;rack&#39;: &#39;unknown-rack&#39;, &#39;host&#39;: &#39;kvm-66&#39; }&#34;</span>

<span style="color:#66d9ef">[mgrs]</span>
<span style="color:#a6e22e">kvm-64</span>
<span style="color:#a6e22e">kvm-65</span>
<span style="color:#a6e22e">kvm-66</span>

<span style="color:#66d9ef">[rgws]</span>
<span style="color:#a6e22e">kvm-64</span>
<span style="color:#a6e22e">kvm-65</span>
<span style="color:#a6e22e">kvm-66</span>
</code></pre></div><p>这里的配置已经足够你部署一套可用的集群了,关于其他的磁盘和网络配置的不同写法等等内容就不再展开了, 配置细节请参考 <a href="https://access.redhat.com/documentation/en-us/red_hat_ceph_storage/3/html/installation_guide_for_red_hat_enterprise_linux/deploying-red-hat-ceph-storage">官方部署文档</a> 给出的各种配置写法说明.</p>
<h4 id="部署节点-部署检查">部署节点-部署检查</h4>
<p>部署前, 首先要进行测试连通性</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#75715e"># ansible all -m ping</span>
kvm-66 | SUCCESS <span style="color:#f92672">=</span>&gt; <span style="color:#f92672">{</span>
    <span style="color:#e6db74">&#34;changed&#34;</span>: false,
    <span style="color:#e6db74">&#34;ping&#34;</span>: <span style="color:#e6db74">&#34;pong&#34;</span>
<span style="color:#f92672">}</span>
kvm-64 | SUCCESS <span style="color:#f92672">=</span>&gt; <span style="color:#f92672">{</span>
    <span style="color:#e6db74">&#34;changed&#34;</span>: false,
    <span style="color:#e6db74">&#34;ping&#34;</span>: <span style="color:#e6db74">&#34;pong&#34;</span>
<span style="color:#f92672">}</span>
kvm-65 | SUCCESS <span style="color:#f92672">=</span>&gt; <span style="color:#f92672">{</span>
    <span style="color:#e6db74">&#34;changed&#34;</span>: false,
    <span style="color:#e6db74">&#34;ping&#34;</span>: <span style="color:#e6db74">&#34;pong&#34;</span>
<span style="color:#f92672">}</span>

</code></pre></div><h2 id="执行部署">执行部署</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#75715e"># 进入工作目录</span>
cd /usr/share/ceph-ansible

<span style="color:#75715e"># 执行部署的 playbook</span>
ansible-playbook site.yml

<span style="color:#75715e"># 部署过程的输出太长这里就不贴了</span>
</code></pre></div><h2 id="检查部署">检查部署</h2>
<p>部署完成后, 登录 monitor 节点查看集群状态</p>
<p>查看 osd 节点状态</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">ceph osd tree
</code></pre></div><p>查看集群的状态</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#75715e"># ceph -s</span>
  cluster:
    id:     65ed06ed-b309-4bd6-84ae-0982190c383b
    health: HEALTH_WARN
            too few PGs per OSD <span style="color:#f92672">(</span><span style="color:#ae81ff">1</span> &lt; min 30<span style="color:#f92672">)</span>
            clock skew detected on mon.kvm-65, mon.kvm-66

  services:
    mon: <span style="color:#ae81ff">3</span> daemons, quorum kvm-64,kvm-65,kvm-66
    mgr: kvm-64<span style="color:#f92672">(</span>active<span style="color:#f92672">)</span>, standbys: kvm-66, kvm-65
    osd: <span style="color:#ae81ff">57</span> osds: <span style="color:#ae81ff">57</span> up, <span style="color:#ae81ff">57</span> in
    rgw: <span style="color:#ae81ff">3</span> daemons active

  data:
    pools:   <span style="color:#ae81ff">4</span> pools, <span style="color:#ae81ff">32</span> pgs
    objects: <span style="color:#ae81ff">190</span> objects, <span style="color:#ae81ff">2822</span> bytes
    usage:   <span style="color:#ae81ff">6262</span> MB used, <span style="color:#ae81ff">103</span> TB / <span style="color:#ae81ff">103</span> TB avail
    pgs:     <span style="color:#ae81ff">32</span> active+clean

</code></pre></div><p>这里的 pg 数为 64, 默认是 3 副本, osd 数量是 57,  每个 osd 上均分的 pg 数量为 <code>32/57 *3</code>, 显然, 这个数量太小了.</p>
<p>查看 <code>pg</code> 数</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#66d9ef">for</span> i in <span style="color:#e6db74">`</span>rados lspools<span style="color:#e6db74">`</span>;<span style="color:#66d9ef">do</span> ceph osd pool get $i pg_num ;<span style="color:#66d9ef">done</span>
</code></pre></div><p>修改一下存储池 <code>pg</code> 和 <code>pgp</code></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#75715e"># for i in `rados lspools`;do ceph osd pool set $i pg_num 256;done</span>
set pool <span style="color:#ae81ff">1</span> pg_num to <span style="color:#ae81ff">256</span>
set pool <span style="color:#ae81ff">2</span> pg_num to <span style="color:#ae81ff">256</span>
set pool <span style="color:#ae81ff">3</span> pg_num to <span style="color:#ae81ff">256</span>
set pool <span style="color:#ae81ff">4</span> pg_num to <span style="color:#ae81ff">256</span>

<span style="color:#75715e"># for i in `rados lspools`;do ceph osd pool set $i pgp_num 256;done</span>
set pool <span style="color:#ae81ff">1</span> pgp_num to <span style="color:#ae81ff">256</span>
set pool <span style="color:#ae81ff">2</span> pgp_num to <span style="color:#ae81ff">256</span>
set pool <span style="color:#ae81ff">3</span> pgp_num to <span style="color:#ae81ff">256</span>
set pool <span style="color:#ae81ff">4</span> pgp_num to <span style="color:#ae81ff">256</span>
</code></pre></div><p>调整完 <code>pg</code> 数量集群均衡数据需要稍等一会</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#75715e"># ceph -s</span>
  cluster:
    id:     65ed06ed-b309-4bd6-84ae-0982190c383b
    health: HEALTH_WARN
            40/636 objects misplaced <span style="color:#f92672">(</span>6.289%<span style="color:#f92672">)</span>
            Reduced data availability: <span style="color:#ae81ff">25</span> pgs inactive, <span style="color:#ae81ff">28</span> pgs peering
            Degraded data redundancy: 5/636 objects degraded <span style="color:#f92672">(</span>0.786%<span style="color:#f92672">)</span>, <span style="color:#ae81ff">2</span> pgs degraded
            clock skew detected on mon.kvm-65, mon.kvm-66

  services:
    mon: <span style="color:#ae81ff">3</span> daemons, quorum kvm-64,kvm-65,kvm-66
    mgr: kvm-64<span style="color:#f92672">(</span>active<span style="color:#f92672">)</span>, standbys: kvm-66, kvm-65
    osd: <span style="color:#ae81ff">57</span> osds: <span style="color:#ae81ff">57</span> up, <span style="color:#ae81ff">57</span> in; <span style="color:#ae81ff">149</span> remapped pgs
    rgw: <span style="color:#ae81ff">3</span> daemons active

  data:
    pools:   <span style="color:#ae81ff">4</span> pools, <span style="color:#ae81ff">1024</span> pgs
    objects: <span style="color:#ae81ff">212</span> objects, <span style="color:#ae81ff">2822</span> bytes
    usage:   <span style="color:#ae81ff">6429</span> MB used, <span style="color:#ae81ff">103</span> TB / <span style="color:#ae81ff">103</span> TB avail
    pgs:     13.672% pgs not active
             5/636 objects degraded <span style="color:#f92672">(</span>0.786%<span style="color:#f92672">)</span>
             40/636 objects misplaced <span style="color:#f92672">(</span>6.289%<span style="color:#f92672">)</span>
             <span style="color:#ae81ff">861</span> active+clean
             <span style="color:#ae81ff">73</span>  peering
             <span style="color:#ae81ff">63</span>  remapped+peering
             <span style="color:#ae81ff">22</span>  active+remapped+backfill_wait
             <span style="color:#ae81ff">2</span>   activating+degraded
             <span style="color:#ae81ff">2</span>   activating
             <span style="color:#ae81ff">1</span>   active+remapped+backfilling

  io:
    recovery: <span style="color:#ae81ff">44</span> B/s, <span style="color:#ae81ff">0</span> objects/s
</code></pre></div><p>这里的时间同步还是出了一点问题, 节点时间存在偏移, 向时间同步服务器同步时间即可.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">  cluster:
    id:     65ed06ed-b309-4bd6-84ae-0982190c383b
    health: HEALTH_WARN
            clock skew detected on mon.kvm-65

  services:
    mon: <span style="color:#ae81ff">3</span> daemons, quorum kvm-64,kvm-65,kvm-66
    mgr: kvm-64<span style="color:#f92672">(</span>active<span style="color:#f92672">)</span>, standbys: kvm-66, kvm-65
    osd: <span style="color:#ae81ff">57</span> osds: <span style="color:#ae81ff">57</span> up, <span style="color:#ae81ff">57</span> in
    rgw: <span style="color:#ae81ff">3</span> daemons active

  data:
    pools:   <span style="color:#ae81ff">4</span> pools, <span style="color:#ae81ff">1024</span> pgs
    objects: <span style="color:#ae81ff">222</span> objects, <span style="color:#ae81ff">2822</span> bytes
    usage:   <span style="color:#ae81ff">6584</span> MB used, <span style="color:#ae81ff">103</span> TB / <span style="color:#ae81ff">103</span> TB avail
    pgs:     <span style="color:#ae81ff">1024</span> active+clean
</code></pre></div><p>集群状态正常.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#75715e"># ceph -s</span>
  cluster:
    id:     65ed06ed-b309-4bd6-84ae-0982190c383b
    health: HEALTH_OK

  services:
    mon: <span style="color:#ae81ff">3</span> daemons, quorum kvm-64,kvm-65,kvm-66
    mgr: kvm-64<span style="color:#f92672">(</span>active<span style="color:#f92672">)</span>, standbys: kvm-66, kvm-65
    osd: <span style="color:#ae81ff">57</span> osds: <span style="color:#ae81ff">57</span> up, <span style="color:#ae81ff">57</span> in
    rgw: <span style="color:#ae81ff">3</span> daemons active

  data:
    pools:   <span style="color:#ae81ff">4</span> pools, <span style="color:#ae81ff">1024</span> pgs
    objects: <span style="color:#ae81ff">222</span> objects, <span style="color:#ae81ff">2822</span> bytes
    usage:   <span style="color:#ae81ff">6584</span> MB used, <span style="color:#ae81ff">103</span> TB / <span style="color:#ae81ff">103</span> TB avail
    pgs:     <span style="color:#ae81ff">1024</span> active+clean
</code></pre></div><p>部署完成.</p>
<p>创建存储池</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#66d9ef">for</span> pool in volumes backups images gnocchi vms ;<span style="color:#66d9ef">do</span>
    ceph osd pool create <span style="color:#e6db74">${</span>pool<span style="color:#e6db74">}</span>-1 <span style="color:#ae81ff">128</span>
    ceph osd pool create <span style="color:#e6db74">${</span>pool<span style="color:#e6db74">}</span>-2 <span style="color:#ae81ff">128</span>
<span style="color:#66d9ef">done</span>

<span style="color:#75715e"># 结果</span>
pool <span style="color:#e6db74">&#39;volumes-1&#39;</span> created
pool <span style="color:#e6db74">&#39;volumes-2&#39;</span> created
pool <span style="color:#e6db74">&#39;backups-1&#39;</span> created
pool <span style="color:#e6db74">&#39;backups-2&#39;</span> created
pool <span style="color:#e6db74">&#39;images-1&#39;</span> created
pool <span style="color:#e6db74">&#39;images-2&#39;</span> created
pool <span style="color:#e6db74">&#39;gnocchi-1&#39;</span> created
pool <span style="color:#e6db74">&#39;gnocchi-2&#39;</span> created
pool <span style="color:#e6db74">&#39;vms-1&#39;</span> created
pool <span style="color:#e6db74">&#39;vms-2&#39;</span> created
</code></pre></div><p>更多 ceph 使用维护,  参见 <a href="https://docs.ceph.com/docs/master/rados/operations/">ceph社区官方的运维文档</a></p>

    </div>

    
    
<div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">文章作者</span>
    <span class="item-content">willmei</span>
  </p>
  <p class="copyright-item">
    <span class="item-title">上次更新</span>
    <span class="item-content">
      2019-11-28
      
    </span>
  </p>
  
  <p class="copyright-item">
    <span class="item-title">许可协议</span>
    <span class="item-content"><a rel="license noopener" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank">CC BY-NC-ND 4.0</a></span>
  </p>
</div>


    
    

    <footer class="post-footer">
      <div class="post-tags">
          <a href="https://www.iterdaily.com/tags/ceph/">ceph</a>
          <a href="https://www.iterdaily.com/tags/ansible/">ansible</a>
          
        </div>

      
      <nav class="post-nav">
        
          <a class="prev" href="/post/shell-script-flavor/">
            
            <i class="iconfont">
              <svg  class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="18" height="18">
  <path d="M691.908486 949.511495l75.369571-89.491197c10.963703-12.998035 10.285251-32.864502-1.499144-44.378743L479.499795 515.267417 757.434875 204.940602c11.338233-12.190647 11.035334-32.285311-0.638543-44.850487l-80.46666-86.564541c-11.680017-12.583596-30.356378-12.893658-41.662889-0.716314L257.233596 494.235404c-11.332093 12.183484-11.041474 32.266891 0.657986 44.844348l80.46666 86.564541c1.772366 1.910513 3.706415 3.533476 5.750981 4.877077l306.620399 321.703933C662.505829 963.726242 680.945807 962.528973 691.908486 949.511495z"></path>
</svg>

            </i>
            <span class="prev-text nav-default">shell书写规范建议</span>
            <span class="prev-text nav-mobile">上一篇</span>
          </a>
        
          <a class="next" href="/post/markdown-math-preview/">
            <span class="next-text nav-default">Markdown 数学公式 Preview</span>
            <span class="prev-text nav-mobile">下一篇</span>
            
            <i class="iconfont">
              <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="18" height="18">
  <path d="M332.091514 74.487481l-75.369571 89.491197c-10.963703 12.998035-10.285251 32.864502 1.499144 44.378743l286.278095 300.375162L266.565125 819.058374c-11.338233 12.190647-11.035334 32.285311 0.638543 44.850487l80.46666 86.564541c11.680017 12.583596 30.356378 12.893658 41.662889 0.716314l377.434212-421.426145c11.332093-12.183484 11.041474-32.266891-0.657986-44.844348l-80.46666-86.564541c-1.772366-1.910513-3.706415-3.533476-5.750981-4.877077L373.270379 71.774697C361.493148 60.273758 343.054193 61.470003 332.091514 74.487481z"></path>
</svg>

            </i>
          </a>
      </nav>
    </footer>
  </article>

  
  

  
  

  

  
  

  

  

  

    

  

        </div>
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="icon-links">
  
  
    <a href="mailto:williammei@126.com" rel="me noopener" class="iconfont"
      title="email" >
      <svg class="icon" viewBox="0 0 1451 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="36" height="36">
  <path d="M664.781909 681.472759 0 97.881301C0 3.997201 71.046997 0 71.046997 0L474.477909 0 961.649408 0 1361.641813 0C1361.641813 0 1432.688811 3.997201 1432.688811 97.881301L771.345323 681.472759C771.345323 681.472759 764.482731 685.154773 753.594283 688.65053L753.594283 688.664858C741.602731 693.493018 729.424896 695.068979 718.077952 694.839748 706.731093 695.068979 694.553173 693.493018 682.561621 688.664858L682.561621 688.65053C671.644501 685.140446 664.781909 681.472759 664.781909 681.472759L664.781909 681.472759ZM718.063616 811.603883C693.779541 811.016482 658.879232 802.205449 619.10784 767.734955 542.989056 701.759633 0 212.052267 0 212.052267L0 942.809523C0 942.809523 0 1024 83.726336 1024L682.532949 1024 753.579947 1024 1348.948139 1024C1432.688811 1024 1432.688811 942.809523 1432.688811 942.809523L1432.688811 212.052267C1432.688811 212.052267 893.138176 701.759633 817.019477 767.734955 777.248 802.205449 742.347691 811.03081 718.063616 811.603883L718.063616 811.603883Z"></path>
</svg>

    </a>
  
    <a href="https://github.com/will-mei" rel="me noopener" class="iconfont"
      title="github"  target="_blank"
      >
      <svg class="icon" style="" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="36" height="36">
  <path d="M512 12.672c-282.88 0-512 229.248-512 512 0 226.261333 146.688 418.133333 350.08 485.76 25.6 4.821333 34.986667-11.008 34.986667-24.618667 0-12.16-0.426667-44.373333-0.64-87.04-142.421333 30.890667-172.458667-68.693333-172.458667-68.693333C188.672 770.986667 155.008 755.2 155.008 755.2c-46.378667-31.744 3.584-31.104 3.584-31.104 51.413333 3.584 78.421333 52.736 78.421333 52.736 45.653333 78.293333 119.850667 55.68 149.12 42.581333 4.608-33.109333 17.792-55.68 32.426667-68.48-113.706667-12.8-233.216-56.832-233.216-253.013333 0-55.893333 19.84-101.546667 52.693333-137.386667-5.76-12.928-23.04-64.981333 4.48-135.509333 0 0 42.88-13.738667 140.8 52.48 40.96-11.392 84.48-17.024 128-17.28 43.52 0.256 87.04 5.888 128 17.28 97.28-66.218667 140.16-52.48 140.16-52.48 27.52 70.528 10.24 122.581333 5.12 135.509333 32.64 35.84 52.48 81.493333 52.48 137.386667 0 196.693333-119.68 240-233.6 252.586667 17.92 15.36 34.56 46.762667 34.56 94.72 0 68.522667-0.64 123.562667-0.64 140.202666 0 13.44 8.96 29.44 35.2 24.32C877.44 942.592 1024 750.592 1024 524.672c0-282.752-229.248-512-512-512"></path>
</svg>

    </a>
  
    <a href="https://git.iterdaily.com" rel="me noopener" class="iconfont"
      title="gitlab"  target="_blank"
      >
      <svg class="icon" style="" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="36" height="36">
  <path d="M59.544137 403.419429L512.115566 983.405714 16.09728 623.396571a39.936 39.936 0 0 1-14.299429-43.995428l57.709715-176.018286z m264.009143 0h377.161143L512.152137 983.405714zM210.40128 53.723429l113.152 349.696H59.544137l113.152-349.696a20.041143 20.041143 0 0 1 37.705143 0z m754.285714 349.696l57.709715 176.018285a39.862857 39.862857 0 0 1-14.299429 43.995429l-496.018286 360.009143 452.571429-579.986286z m0 0h-264.009143l113.152-349.696a20.041143 20.041143 0 0 1 37.705143 0z"></path>
</svg>

    </a>
  
    <a href="https://space.bilibili.com/7388823" rel="me noopener" class="iconfont"
      title="bilibili"  target="_blank"
      >
      <svg
  class="icon" style="" viewBox="0 0 1024 1024" version="1.1" width="36"
  height="36" id="svg8">
  <path
      style=""
      d="M 744.60599,0.00486267 A 41.779915,41.779915 0 0 0 710.4184,18.673394 L 548.5048,255.32642 h -11.70046 a 41.779915,41.779915 0 0 0 -10.80295,-7.84928 L 235.66,97.084498 a 41.779915,41.779915 0 0 0 -20.07193,-4.960864 41.779915,41.779915 0 0 0 -18.3748,79.145436 L 359.4859,255.32642 H 128.16909 c -49.458302,0 -89.27932,39.82105 -89.27932,89.27932 v 508.65224 c 0,49.4583 39.821018,89.27934 89.27932,89.27934 h 19.48445 C 149.12802,984.5043 179.92773,1024 224.79179,1024 c 44.86407,0 75.66379,-39.4957 77.13826,-81.46268 H 719.98116 C 721.45559,984.5043 752.25533,1024 797.1194,1024 c 44.86406,0 75.6638,-39.4957 77.13824,-81.46268 h 21.57323 c 49.45831,0 89.27936,-39.82104 89.27936,-89.27934 V 344.60574 c 0,-49.45827 -39.82105,-89.27932 -89.27936,-89.27932 H 649.74567 L 779.38103,65.866924 A 41.779915,41.779915 0 0 0 744.60599,0.00486267 Z M 644.49108,418.70871 c 6.29985,0.21538 12.44451,2.01107 17.86888,5.22196 l 171.36218,98.10771 c 18.23417,10.21935 24.63334,33.34627 14.24614,51.48533 -10.38726,18.13909 -33.57344,24.32718 -51.61587,13.77296 L 624.9903,489.18895 c -15.21356,-8.41858 -22.66871,-26.1765 -18.03211,-42.93436 4.63664,-16.75784 20.15573,-28.14465 37.53289,-27.54588 z M 350.2006,432.31846 c 16.89952,0.0317 31.69582,11.33328 36.17844,27.62747 4.48262,16.2942 -2.44981,33.57765 -16.95507,42.24898 l -140.7157,86.91312 c -17.68528,11.18244 -41.09629,5.77692 -52.08912,-12.02686 -10.99282,-17.80373 -5.33855,-41.15658 12.58167,-51.95857 L 329.9002,438.2095 c 6.0643,-3.86439 13.10951,-5.90891 20.3004,-5.89104 z M 501.605,641.53985 c 3.75002,-0.15248 7.48645,0.53903 10.93349,2.0235 0.15842,0.0637 0.31618,0.12888 0.47325,0.19582 0.59328,0.27092 1.17574,0.56489 1.74609,0.88121 0.15868,0.0854 0.31643,0.17233 0.47325,0.2611 0.55694,0.32165 1.10131,0.66458 1.63185,1.02807 0.16455,0.1123 0.32777,0.2265 0.48956,0.34269 0.50382,0.36781 0.99371,0.75428 1.46868,1.15864 0.18724,0.15504 0.37218,0.31282 0.55484,0.47323 0.43271,0.38784 0.8518,0.79061 1.25653,1.20756 0.15449,0.16114 0.30679,0.32437 0.45693,0.48959 0.40798,0.44266 0.79989,0.89988 1.17494,1.37076 0.17799,0.22544 0.35205,0.45395 0.5222,0.68538 0.25932,0.34701 0.50964,0.70071 0.75064,1.06071 0.26712,0.39516 0.52286,0.79784 0.76699,1.20757 0.16907,0.29043 0.33231,0.58424 0.48957,0.88123 0.21836,0.41297 0.42513,0.83199 0.62009,1.25653 0.14836,0.32333 0.28983,0.64976 0.42429,0.97911 0.21319,0.51552 0.40915,1.03801 0.58747,1.5666 0.0677,0.19499 0.13296,0.39085 0.19582,0.58748 0.18652,0.60823 0.34984,1.22334 0.48957,1.84399 0.0397,0.16277 0.0779,0.32601 0.11423,0.48957 0.1436,0.69112 0.25788,1.38801 0.34269,2.08877 0.005,0.0381 0.0111,0.0761 0.0163,0.11424 0.0857,0.78056 0.13474,1.56471 0.14687,2.34988 0.005,0.0543 0.0111,0.10879 0.0163,0.1632 0,0 -0.008,1.12132 0,1.45234 0,0 -0.14697,17.84761 5.89102,34.12231 3.01902,8.13734 7.33278,15.10615 12.61433,19.61501 5.28157,4.50889 11.42894,7.62081 23.64572,7.62081 12.2168,0 18.36416,-3.11192 23.64573,-7.62081 5.28154,-4.50886 9.5953,-11.47767 12.6143,-19.61501 6.03799,-16.2747 5.89103,-34.12231 5.89103,-34.12231 -0.44885,-13.87045 10.45922,-25.46302 24.3311,-25.86506 13.87189,-0.40201 25.42828,10.53953 25.78348,24.41272 0,0 1.11929,25.7226 -9.00791,53.01927 -5.06359,13.64832 -13.1986,28.46036 -27.05631,40.29073 -13.85772,11.83039 -33.5454,19.63135 -56.20142,19.63135 -22.65603,0 -42.34371,-7.80096 -56.20141,-19.63135 -4.1801,-3.56856 -7.78733,-7.42433 -10.99878,-11.42303 -3.21235,4.00037 -6.81703,7.85309 -10.99876,11.42303 -13.85773,11.83039 -33.5454,19.63135 -56.20144,19.63135 -22.65601,0 -42.3437,-7.80096 -56.2014,-19.63135 -13.85775,-11.83037 -21.99272,-26.64241 -27.05632,-40.29073 -10.12725,-27.29667 -9.00789,-53.01928 -9.00789,-53.01927 0.20714,-13.83687 11.58744,-24.88848 25.42444,-24.69013 14.1263,0.19991 25.2971,12.0278 24.69011,26.14247 0,0 -0.14697,17.84761 5.89103,34.12231 3.01902,8.13734 7.31646,15.10615 12.598,19.61501 5.28155,4.50889 11.44526,7.62081 23.66203,7.62081 12.21681,0 18.36418,-3.11192 23.64573,-7.62081 5.28154,-4.50886 9.57899,-11.47767 12.598,-19.61501 5.76352,-15.53489 5.89112,-32.05691 5.89103,-33.56746 0.006,-0.37466 0.0111,-1.05336 0.0163,-1.20759 -0.0117,-0.74583 0.0105,-1.49177 0.0652,-2.23565 0.009,-0.15784 0.0204,-0.31561 0.0327,-0.47324 0.14204,-1.56859 0.43163,-3.12027 0.86487,-4.63449 0.0213,-0.0763 0.0433,-0.15244 0.0652,-0.22848 3.0335,-10.25748 12.24157,-17.46007 22.92769,-17.93417 z"
      id="rect824"/>
</svg>

    </a>


<a href="https://www.iterdaily.com/index.xml" rel="noopener alternate" type="application/rss&#43;xml"
    class="iconfont" title="rss" target="_blank">
    <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="30" height="30">
  <path d="M819.157333 1024C819.157333 574.592 449.408 204.8 0 204.8V0c561.706667 0 1024 462.293333 1024 1024h-204.842667zM140.416 743.04a140.8 140.8 0 0 1 140.501333 140.586667A140.928 140.928 0 0 1 140.074667 1024C62.72 1024 0 961.109333 0 883.626667s62.933333-140.544 140.416-140.586667zM678.784 1024h-199.04c0-263.210667-216.533333-479.786667-479.744-479.786667V345.173333c372.352 0 678.784 306.517333 678.784 678.826667z"></path>
</svg>

  </a>
   
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - <a class="theme-link" href="https://github.com/xianmin/hugo-theme-jane">Jane</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
     备案 - <a class="theme-link" href="http://www.beian.miit.gov.cn/">京ICP备19054960号-1</a>
  </span>

  <span class="copyright-year">
    &copy;
    
      2019 -
    2021
    <span class="heart">
      
      <i class="iconfont">
        <svg class="icon" viewBox="0 0 1025 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="14" height="14">
  <path d="M1000.1 247.9c-15.5-37.3-37.6-70.6-65.7-98.9-54.4-54.8-125.8-85-201-85-85.7 0-166 39-221.4 107.4C456.6 103 376.3 64 290.6 64c-75.1 0-146.5 30.4-201.1 85.6-28.2 28.5-50.4 61.9-65.8 99.3-16 38.8-24 79.9-23.6 122.2 0.7 91.7 40.1 177.2 108.1 234.8 3.1 2.6 6 5.1 8.9 7.8 14.9 13.4 58 52.8 112.6 102.7 93.5 85.5 209.9 191.9 257.5 234.2 7 6.1 15.8 9.5 24.9 9.5 9.2 0 18.1-3.4 24.9-9.5 34.5-30.7 105.8-95.9 181.4-165 74.2-67.8 150.9-138 195.8-178.2 69.5-57.9 109.6-144.4 109.9-237.3 0.1-42.5-8-83.6-24-122.2z"
   fill="#8a8a8a"></path>
</svg>

      </i>
    </span><span class="author">
        WilliamMei
        
      </span></span>

  
  
    <span id="busuanzi_container">
      访客数/访问量：<span id="busuanzi_value_site_uv"></span>/<span id="busuanzi_value_site_pv"></span>
    </span>
  

  
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont">
        
        <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="35" height="35">
  <path d="M510.866688 227.694839 95.449397 629.218702l235.761562 0-2.057869 328.796468 362.40389 0L691.55698 628.188232l241.942331-3.089361L510.866688 227.694839zM63.840492 63.962777l894.052392 0 0 131.813095L63.840492 195.775872 63.840492 63.962777 63.840492 63.962777zM63.840492 63.962777"></path>
</svg>

      </i>
    </div>
  </div>
  
<script type="text/javascript" src="/lib/jquery/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout-1.0.1.min.js"></script>




<script type="text/javascript" src="/js/main.638251f4230630f0335d8c6748e53a96f94b72670920b60c09a56fdc8bece214.js" integrity="sha256-Y4JR9CMGMPAzXYxnSOU6lvlLcmcJILYMCaVv3Ivs4hQ=" crossorigin="anonymous"></script>












  
    <script type="text/javascript" src="/js/load-photoswipe.js"></script>
    <script type="text/javascript" src="/lib/photoswipe/photoswipe.min.js"></script>
    <script type="text/javascript" src="/lib/photoswipe/photoswipe-ui-default.min.js"></script>
  




  <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>













<script type="text/javascript" src="//cdn.bootcss.com/viz.js/1.3.0/viz.js"> </script>
<script type="text/javascript">
(function(){
    var vizPrefix = "language-viz-";
    Array.prototype.forEach.call(document.querySelectorAll("[class^=" + vizPrefix + "]"), function(x){
        var engine;
        x.getAttribute("class").split(" ").forEach(function(cls){
            if (cls.startsWith(vizPrefix)) {
                engine = cls.substr(vizPrefix.length);
            }
        });
        var image = new DOMParser().parseFromString(Viz(x.innerText, {format:"svg", engine:engine}), "image/svg+xml");
        x.parentNode.insertBefore(image.documentElement, x);
        x.style.display = 'none'
    });
})();
</script>

</body>
</html>
